<div class="p-4">
  <div class="flex align-items-center justify-content-between mb-4">
    <div>
      <h1 class="text-3xl font-bold text-900 m-0">Dashboard</h1>
      <p class="text-500 mt-1">Resumen ejecutivo del sistema de gestion de riesgos</p>
    </div>
    <p-button label="Generar Reporte" icon="pi pi-file-pdf" severity="secondary"></p-button>
  </div>

  <!-- KPIs Cards -->
  <div class="grid mb-4">
    <div class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="h-full">
        <div class="flex align-items-center gap-3">
          <div class="flex align-items-center justify-content-center bg-blue-100 border-round" style="width: 3rem; height: 3rem;">
            <span class="material-icons text-blue-500">inventory_2</span>
          </div>
          <div>
            <p class="text-500 text-sm m-0 mb-1">Total Activos</p>
            <p class="text-2xl font-bold text-900 m-0">{{ stats().totalActivos }}</p>
          </div>
        </div>
        <div class="mt-3 pt-3 border-top-1 surface-border">
          <span class="text-orange-500 font-medium">{{ stats().activosCriticos }}</span>
          <span class="text-500 text-sm"> activos criticos</span>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="h-full">
        <div class="flex align-items-center gap-3">
          <div class="flex align-items-center justify-content-center bg-orange-100 border-round" style="width: 3rem; height: 3rem;">
            <span class="material-icons text-orange-500">warning</span>
          </div>
          <div>
            <p class="text-500 text-sm m-0 mb-1">Riesgos Identificados</p>
            <p class="text-2xl font-bold text-900 m-0">{{ stats().totalRiesgos }}</p>
          </div>
        </div>
        <div class="mt-3 pt-3 border-top-1 surface-border">
          <span class="text-red-500 font-medium">{{ stats().riesgosCriticos }}</span>
          <span class="text-500 text-sm"> riesgos criticos</span>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="h-full">
        <div class="flex align-items-center gap-3">
          <div class="flex align-items-center justify-content-center bg-red-100 border-round" style="width: 3rem; height: 3rem;">
            <span class="material-icons text-red-500">bolt</span>
          </div>
          <div>
            <p class="text-500 text-sm m-0 mb-1">Incidentes</p>
            <p class="text-2xl font-bold text-900 m-0">{{ stats().totalIncidentes }}</p>
          </div>
        </div>
        <div class="mt-3 pt-3 border-top-1 surface-border">
          <span class="text-red-500 font-medium">{{ stats().incidentesAbiertos }}</span>
          <span class="text-500 text-sm"> abiertos</span>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="h-full">
        <div class="flex align-items-center gap-3">
          <div class="flex align-items-center justify-content-center bg-purple-100 border-round" style="width: 3rem; height: 3rem;">
            <span class="material-icons text-purple-500">bug_report</span>
          </div>
          <div>
            <p class="text-500 text-sm m-0 mb-1">Defectos</p>
            <p class="text-2xl font-bold text-900 m-0">{{ stats().totalDefectos }}</p>
          </div>
        </div>
        <div class="mt-3 pt-3 border-top-1 surface-border">
          <span class="text-green-500 font-medium">85%</span>
          <span class="text-500 text-sm"> tasa de resolucion</span>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Graficos -->
  <div class="grid mb-4">
    <div class="col-12 lg:col-6">
      <p-card header="Riesgos por Tipo de Activo">
        <p-chart type="doughnut" [data]="riesgosPorTipoData()" [options]="chartOptions" [style]="{ height: '300px' }"></p-chart>
      </p-card>
    </div>
    <div class="col-12 lg:col-6">
      <p-card header="Incidentes por Severidad">
        <p-chart type="bar" [data]="incidentesPorSeveridadData()" [options]="chartOptions" [style]="{ height: '300px' }"></p-chart>
      </p-card>
    </div>
  </div>

  <!-- Accesos Rapidos -->
  <div class="grid">
    <div class="col-12">
      <p-card header="Acciones Rapidas">
        <div class="flex flex-wrap gap-3">
          <p-button label="Registrar Activo" icon="pi pi-plus" routerLink="/activos"></p-button>
          <p-button label="Nuevo Riesgo" icon="pi pi-exclamation-triangle" severity="warn" routerLink="/riesgos"></p-button>
          <p-button label="Reportar Incidente" icon="pi pi-bolt" severity="danger" routerLink="/incidentes"></p-button>
          <p-button label="Registrar Defecto" icon="pi pi-bug" severity="help" routerLink="/defectos"></p-button>
          <p-button label="Ver Organigrama" icon="pi pi-sitemap" severity="secondary" routerLink="/organigramas"></p-button>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Ultimos Activos -->
  <div class="grid mt-4">
    <div class="col-12">
      <p-card header="Activos Recientes">
        <div class="flex flex-column gap-3">
          @for (activo of activos().slice(0, 5); track activo.id) {
            <div class="flex align-items-center justify-content-between p-3 surface-100 border-round">
              <div class="flex align-items-center gap-3">
                <div class="flex align-items-center justify-content-center border-round"
                     [class]="activo.criticidad === 'alta' ? 'bg-red-100' : activo.criticidad === 'media' ? 'bg-orange-100' : 'bg-green-100'"
                     style="width: 2.5rem; height: 2.5rem;">
                  <span class="material-icons"
                        [class]="activo.criticidad === 'alta' ? 'text-red-500' : activo.criticidad === 'media' ? 'text-orange-500' : 'text-green-500'">
                    @switch (activo.tipo) {
                      @case ('hardware') { memory }
                      @case ('software') { code }
                      @case ('datos') { storage }
                      @case ('personas') { people }
                      @case ('instalaciones') { business }
                    }
                  </span>
                </div>
                <div>
                  <p class="font-medium text-900 m-0">{{ activo.nombre }}</p>
                  <p class="text-sm text-500 m-0">{{ activo.departamento }} - {{ activo.responsable }}</p>
                </div>
              </div>
              <div class="flex align-items-center gap-4">
                <div class="text-center">
                  <p class="text-sm text-500 m-0">Riesgos</p>
                  <p class="font-bold text-orange-500 m-0">{{ activo.riesgos.length }}</p>
                </div>
                <div class="text-center">
                  <p class="text-sm text-500 m-0">Incidentes</p>
                  <p class="font-bold text-red-500 m-0">{{ activo.incidentes.length }}</p>
                </div>
                <div class="text-center">
                  <p class="text-sm text-500 m-0">Defectos</p>
                  <p class="font-bold text-purple-500 m-0">{{ activo.defectos.length }}</p>
                </div>
                <p-button icon="pi pi-arrow-right" [rounded]="true" [text]="true" routerLink="/activos"></p-button>
              </div>
            </div>
          }
        </div>
      </p-card>
    </div>
  </div>
</div>
