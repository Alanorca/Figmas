<div class="tables-page">
  <p-toast />
  <p-confirmDialog />

  <header class="page-header">
    <h1>Tables</h1>
    <p class="subtitle">
      Data tables display information in a grid of rows and columns with features like sorting, filtering, and pagination.
      <strong>All examples below are interactive - try them!</strong>
    </p>
  </header>

  <!-- Interactive Data Table Demo -->
  <section class="section highlight-section">
    <h2><i class="pi pi-bolt"></i> Interactive Product Management Table</h2>
    <p class="section-description">
      Full CRUD table with search, selection, and actions. Try adding, editing, or deleting products.
    </p>
    <app-ds-preview title="Product Management" [showModeToggle]="false">
      <div class="interactive-table-demo">
        <!-- Stats Summary -->
        <div class="table-stats">
          <div class="stat-item">
            <span class="stat-value">{{ totalProducts() }}</span>
            <span class="stat-label">Products</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ totalValue() | currency }}</span>
            <span class="stat-label">Total Value</span>
          </div>
          <div class="stat-item warning">
            <span class="stat-value">{{ lowStockCount() }}</span>
            <span class="stat-label">Low/Out Stock</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ selectedProducts().length }}</span>
            <span class="stat-label">Selected</span>
          </div>
        </div>

        <!-- Toolbar -->
        <p-toolbar styleClass="table-toolbar">
          <ng-template pTemplate="left">
            <p-button
              label="New"
              icon="pi pi-plus"
              (onClick)="addProduct()"
              pTooltip="Add new product"
            />
            <p-button
              label="Delete"
              icon="pi pi-trash"
              severity="danger"
              [outlined]="true"
              (onClick)="deleteSelected()"
              [disabled]="selectedProducts().length === 0"
              pTooltip="Delete selected"
            />
            <p-button
              icon="pi pi-refresh"
              [outlined]="true"
              (onClick)="refreshData()"
              pTooltip="Refresh data"
            />
          </ng-template>
          <ng-template pTemplate="right">
            <p-button
              icon="pi pi-download"
              [outlined]="true"
              (onClick)="exportData()"
              pTooltip="Export to CSV"
            />
            <p-iconField>
              <p-inputIcon styleClass="pi pi-search" />
              <input
                pInputText
                placeholder="Search products..."
                [ngModel]="searchValue()"
                (ngModelChange)="searchValue.set($event)"
              />
            </p-iconField>
          </ng-template>
        </p-toolbar>

        <!-- Table -->
        <p-table
          [value]="filteredProducts()"
          [(selection)]="selectedProducts"
          (selectionChange)="onSelectionChange($event)"
          dataKey="id"
          [paginator]="true"
          [rows]="5"
          [rowsPerPageOptions]="[5, 10, 20]"
          styleClass="p-datatable-sm"
          [globalFilterFields]="['name', 'category', 'status']"
        >
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 3rem">
                <p-tableHeaderCheckbox />
              </th>
              <th pSortableColumn="name">Name <p-sortIcon field="name" /></th>
              <th pSortableColumn="category">Category <p-sortIcon field="category" /></th>
              <th pSortableColumn="price">Price <p-sortIcon field="price" /></th>
              <th pSortableColumn="quantity">Qty <p-sortIcon field="quantity" /></th>
              <th pSortableColumn="status">Status <p-sortIcon field="status" /></th>
              <th style="width: 8rem">Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-product>
            <tr>
              <td>
                <p-tableCheckbox [value]="product" />
              </td>
              <td>
                <span class="product-name">{{ product.name }}</span>
              </td>
              <td>{{ product.category }}</td>
              <td>{{ product.price | currency }}</td>
              <td>
                <span [class.low-qty]="product.quantity <= 5">{{ product.quantity }}</span>
              </td>
              <td>
                <p-tag [value]="product.status" [severity]="getSeverity(product.status)" />
              </td>
              <td>
                <p-button
                  icon="pi pi-pencil"
                  [text]="true"
                  [rounded]="true"
                  (onClick)="editProduct(product)"
                  pTooltip="Edit"
                />
                <p-button
                  icon="pi pi-trash"
                  [text]="true"
                  [rounded]="true"
                  severity="danger"
                  (onClick)="deleteProduct(product)"
                  pTooltip="Delete"
                />
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="7" class="empty-message">
                <i class="pi pi-inbox"></i>
                <span>No products found</span>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </app-ds-preview>
    <app-ds-code-block [code]="interactiveCode" language="typescript" />
  </section>

  <section class="section">
    <h2>Basic Table</h2>
    <p class="section-description">
      Simple table with header and body templates.
    </p>
    <app-ds-preview title="Basic Table" [showModeToggle]="false">
      <div class="table-demo">
        <p-table [value]="products()" styleClass="p-datatable-sm">
          <ng-template pTemplate="header">
            <tr>
              <th>Name</th>
              <th>Category</th>
              <th>Price</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-product>
            <tr>
              <td>{{ product.name }}</td>
              <td>{{ product.category }}</td>
              <td>{{ product.price | currency }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </app-ds-preview>
    <app-ds-code-block [code]="basicCode" language="html" />
  </section>

  <section class="section">
    <h2>Sortable Table</h2>
    <p class="section-description">
      Enable column sorting by clicking on headers.
    </p>
    <app-ds-preview title="Sortable Table" [showModeToggle]="false">
      <div class="table-demo">
        <p-table [value]="products()" styleClass="p-datatable-sm">
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="name">Name <p-sortIcon field="name" /></th>
              <th pSortableColumn="category">Category <p-sortIcon field="category" /></th>
              <th pSortableColumn="price">Price <p-sortIcon field="price" /></th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-product>
            <tr>
              <td>{{ product.name }}</td>
              <td>{{ product.category }}</td>
              <td>{{ product.price | currency }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </app-ds-preview>
    <app-ds-code-block [code]="sortableCode" language="html" />
  </section>

  <section class="section">
    <h2>Striped & Gridlines</h2>
    <p class="section-description">
      Visual variations for tables.
    </p>
    <app-ds-preview title="Striped Table" [showModeToggle]="false">
      <div class="table-demo">
        <p-table [value]="products()" styleClass="p-datatable-sm p-datatable-striped p-datatable-gridlines">
          <ng-template pTemplate="header">
            <tr>
              <th>Name</th>
              <th>Category</th>
              <th>Price</th>
              <th>Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-product>
            <tr>
              <td>{{ product.name }}</td>
              <td>{{ product.category }}</td>
              <td>{{ product.price | currency }}</td>
              <td>
                <p-tag [value]="product.status" [severity]="getSeverity(product.status)" />
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </app-ds-preview>
  </section>
</div>
