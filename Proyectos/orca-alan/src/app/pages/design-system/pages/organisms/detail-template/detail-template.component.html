<div class="guide-page">
  <header class="page-header">
    <h1>Plantilla de Detalle</h1>
    <p class="subtitle">
      Template para páginas de detalle de entidades (activos, procesos, riesgos, etc.).
      Incluye header con tabs, layout de 2 columnas, y sidebar con estadísticas.
      <strong>Usado en Detalle de Activo, Detalle de Proceso, etc.</strong>
    </p>
  </header>

  <!-- Guidelines -->
  <app-ds-guidelines
    [dos]="guidelinesDos"
    [donts]="guidelinesDonts"
    [compact]="true"
  />

  <!-- Estructura del Layout -->
  <section class="section">
    <h2><i class="pi pi-th-large"></i> Estructura del Layout</h2>
    <p class="section-description">
      El template de detalle sigue una estructura de 2 columnas con header superior
      que mantiene consistencia visual en todas las páginas de detalle.
    </p>

    <div class="layout-diagram">
      <div class="layout-box layout-header full-width">
        <span class="layout-label">page-header</span>
        <span class="layout-desc">Título + Subtítulo | Tabs principales (derecha)</span>
      </div>
      <div class="layout-two-columns">
        <div class="layout-column main">
          <div class="layout-box layout-content">
            <span class="layout-label">main-content</span>
            <span class="layout-desc">Entity header + Secondary tabs + Tab content</span>
          </div>
        </div>
        <div class="layout-column side">
          <div class="layout-box layout-sidebar">
            <span class="layout-label">sidebar</span>
            <span class="layout-desc">Stats + Graph</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Demo Interactivo -->
  <section class="section">
    <h2><i class="pi pi-bolt"></i> Demo Interactivo</h2>
    <p class="section-description">Selecciona el tipo de entidad y navega entre los tabs para ver cómo funciona el template.</p>

    <!-- Entity Type Selector -->
    <div class="entity-type-selector">
      @for (entity of entityTypes; track entity.id) {
        <button
          class="entity-type-btn"
          [class.active]="selectedEntityType() === entity.id"
          (click)="onEntityTypeChange($any(entity.id))">
          <i [class]="entity.icon"></i>
          {{ entity.label }}
        </button>
      }
    </div>

    <app-ds-preview [title]="currentConfig().title">
      <div class="demo-detail">
        <!-- Header -->
        <div class="demo-header">
          <div class="demo-header-left">
            <h3>{{ currentConfig().title }}</h3>
            <p>{{ currentConfig().subtitle }}</p>
          </div>
          <div class="demo-header-right">
            @for (tab of currentConfig().mainTabs; track tab.id) {
              <button
                class="demo-main-tab"
                [class.active]="mainTab() === tab.id"
                (click)="mainTab.set(tab.id)">
                <i [class]="tab.icon"></i>
                {{ tab.label }}
              </button>
            }
          </div>
        </div>

        <p-divider />

        <!-- Layout 2 columnas -->
        <div class="demo-layout">
          <!-- Main Content -->
          <div class="demo-main-content">
            <!-- Entity Header Row -->
            <div class="demo-entity-row">
              <div class="demo-entity-info">
                <h4>{{ currentConfig().description.substring(0, 40) }}... <span class="code">{{ currentConfig().code }}</span></h4>
                <p>{{ currentConfig().description }}</p>
              </div>
              <div class="demo-status-card" [class]="currentConfig().statusCard.color">
                <div class="status-header">
                  <i [class]="currentConfig().statusCard.icon"></i>
                  <span>{{ currentConfig().statusCard.title }}</span>
                  <p-tag [value]="currentConfig().statusCard.status" [severity]="currentConfig().statusCard.severity" />
                </div>
                @if (selectedEntityType() === 'activo') {
                  <div class="status-progress">
                    <span>Incidentes: 2 / 5</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 40%"></div>
                    </div>
                  </div>
                }
                @if (selectedEntityType() === 'riesgo') {
                  <div class="status-metrics">
                    <span class="metric">Inherente: <strong>16</strong></span>
                    <span class="metric">Residual: <strong>8</strong></span>
                  </div>
                }
                @if (selectedEntityType() === 'incidente') {
                  <div class="status-metrics">
                    <span class="metric">Severidad: <strong>Alta</strong></span>
                  </div>
                }
                @if (selectedEntityType() === 'defecto') {
                  <div class="status-metrics">
                    <span class="metric">Prioridad: <strong>P1</strong></span>
                  </div>
                }
              </div>
            </div>

            <!-- Secondary Tabs -->
            <div class="demo-secondary-tabs">
              @for (tab of currentConfig().secondaryTabs; track tab.id) {
                <button
                  class="secondary-tab-btn"
                  [class.active]="secondaryTab() === tab.id"
                  (click)="secondaryTab.set(tab.id)">
                  <i [class]="tab.icon"></i>
                  {{ tab.label }}
                </button>
              }
            </div>

            <!-- Tab Content -->
            <div class="demo-tab-content">
              @if (secondaryTab() === 'info') {
                <div class="demo-info-grid">
                  @if (selectedEntityType() === 'activo') {
                    <div class="info-item">
                      <label>Responsable</label>
                      <div class="value with-avatar">
                        <p-avatar label="AJ" shape="circle" />
                        <span>Alice Johnson</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <label>Organización</label>
                      <div class="value">Empresa ABC · Operaciones · IT</div>
                    </div>
                    <div class="info-item">
                      <label>Última Revisión</label>
                      <div class="value">15/01/2024</div>
                    </div>
                    <div class="info-item">
                      <label>Estado</label>
                      <div class="value">
                        <p-tag value="Activo" severity="success" />
                      </div>
                    </div>
                  }
                  @if (selectedEntityType() === 'riesgo') {
                    <div class="info-item">
                      <label>Propietario del Riesgo</label>
                      <div class="value with-avatar">
                        <p-avatar label="MG" shape="circle" />
                        <span>María García</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <label>Categoría</label>
                      <div class="value">Seguridad de la Información</div>
                    </div>
                    <div class="info-item">
                      <label>Fecha Identificación</label>
                      <div class="value">08/01/2024</div>
                    </div>
                    <div class="info-item">
                      <label>Estado</label>
                      <div class="value">
                        <p-tag value="En Evaluación" severity="warn" />
                      </div>
                    </div>
                  }
                  @if (selectedEntityType() === 'incidente') {
                    <div class="info-item">
                      <label>Reportado por</label>
                      <div class="value with-avatar">
                        <p-avatar label="JL" shape="circle" />
                        <span>Juan López</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <label>Asignado a</label>
                      <div class="value with-avatar">
                        <p-avatar label="CR" shape="circle" />
                        <span>Carlos Ruiz</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <label>Fecha del Incidente</label>
                      <div class="value">25/01/2024 14:32</div>
                    </div>
                    <div class="info-item">
                      <label>Estado</label>
                      <div class="value">
                        <p-tag value="En Proceso" severity="warn" />
                      </div>
                    </div>
                  }
                  @if (selectedEntityType() === 'defecto') {
                    <div class="info-item">
                      <label>Descubierto por</label>
                      <div class="value with-avatar">
                        <p-avatar label="AP" shape="circle" />
                        <span>Ana Pérez</span>
                      </div>
                    </div>
                    <div class="info-item">
                      <label>Tipo de Defecto</label>
                      <div class="value">Vulnerabilidad de Seguridad</div>
                    </div>
                    <div class="info-item">
                      <label>Fecha Descubrimiento</label>
                      <div class="value">20/01/2024</div>
                    </div>
                    <div class="info-item">
                      <label>Estado</label>
                      <div class="value">
                        <p-tag value="Abierto" severity="danger" />
                      </div>
                    </div>
                  }
                </div>
              }
              @if (secondaryTab() === 'salud' || secondaryTab() === 'analisis') {
                <div class="demo-health-panel">
                  @if (selectedEntityType() === 'activo') {
                    <p class="text-secondary">Panel de análisis de salud del activo...</p>
                  }
                  @if (selectedEntityType() === 'riesgo') {
                    <div class="risk-analysis-demo">
                      <div class="analysis-row">
                        <div class="analysis-item">
                          <label>Probabilidad</label>
                          <p-tag value="Alta (4)" severity="warn" />
                        </div>
                        <div class="analysis-item">
                          <label>Impacto</label>
                          <p-tag value="Mayor (4)" severity="warn" />
                        </div>
                        <div class="analysis-item">
                          <label>Riesgo Inherente</label>
                          <p-tag value="16 - Alto" severity="danger" />
                        </div>
                      </div>
                    </div>
                  }
                </div>
              }
              @if (secondaryTab() === 'config' || secondaryTab() === 'respuesta' || secondaryTab() === 'solucion') {
                <div class="demo-config-panel">
                  @if (selectedEntityType() === 'activo') {
                    <p class="text-secondary">Configuración de tolerancia a incidentes...</p>
                  }
                  @if (selectedEntityType() === 'incidente') {
                    <p class="text-secondary">Plan de respuesta y acciones tomadas...</p>
                  }
                  @if (selectedEntityType() === 'defecto') {
                    <p class="text-secondary">Solución propuesta y pasos de remediación...</p>
                  }
                </div>
              }
              @if (secondaryTab() === 'propiedades') {
                <div class="demo-props-panel">
                  <p class="text-secondary">Propiedades personalizadas de la entidad...</p>
                </div>
              }
            </div>
          </div>

          <!-- Sidebar -->
          <div class="demo-sidebar">
            <div class="demo-stat-row">
              <div class="demo-stat-card">
                <div class="stat-indicator" [class]="currentConfig().stats[0].indicator"></div>
                <div class="stat-info">
                  <span class="stat-label">{{ currentConfig().stats[0].label }}</span>
                  <span class="stat-value">{{ currentConfig().stats[0].value }}</span>
                </div>
              </div>
              <div class="demo-stat-card">
                <div class="stat-indicator" [class]="currentConfig().stats[1].indicator"></div>
                <div class="stat-info">
                  <span class="stat-label">{{ currentConfig().stats[1].label }}</span>
                  <span class="stat-value">{{ currentConfig().stats[1].value }}</span>
                </div>
              </div>
            </div>
            <div class="demo-stat-row">
              <div class="demo-stat-card">
                <div class="stat-indicator" [class]="currentConfig().stats[2].indicator"></div>
                <div class="stat-info">
                  <span class="stat-label">{{ currentConfig().stats[2].label }}</span>
                  <span class="stat-value">{{ currentConfig().stats[2].value }}</span>
                </div>
              </div>
              <div class="demo-stat-card">
                <div class="stat-indicator" [class]="currentConfig().stats[3].indicator"></div>
                <div class="stat-info">
                  <span class="stat-label">{{ currentConfig().stats[3].label }}</span>
                  <span class="stat-value">{{ currentConfig().stats[3].value }}</span>
                </div>
              </div>
            </div>
            <div class="demo-graph-card">
              <div class="graph-header">
                <span>{{ selectedEntityType() === 'riesgo' ? 'Matriz de Riesgo' : 'Relaciones' }}</span>
                <i class="pi pi-expand"></i>
              </div>
              <div class="graph-placeholder">
                <i [class]="selectedEntityType() === 'riesgo' ? 'pi pi-th-large' : 'pi pi-share-alt'"></i>
                <span>{{ selectedEntityType() === 'riesgo' ? 'Mapa de calor' : 'Grafo de relaciones' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </app-ds-preview>
  </section>

  <!-- Componentes del Header -->
  <section class="section">
    <h2><i class="pi pi-bookmark"></i> Header de Página</h2>
    <p class="section-description">
      El header contiene el título, subtítulo y los tabs de navegación principal.
      Los tabs usan p-button para consistencia con el Design System.
    </p>

    <div class="info-card">
      <h4><i class="pi pi-info-circle text-primary"></i> Tabs Principales vs Secundarios</h4>
      <ul>
        <li><strong>Tabs Principales (header):</strong> Navegación de alto nivel entre secciones mayores (Info, Reglas, Riesgos, Auditoría)</li>
        <li><strong>Tabs Secundarios (content):</strong> Sub-navegación dentro de una sección (Info General, Salud, Config, Propiedades)</li>
        <li>Usar <code>p-button</code> para tabs principales (más prominentes)</li>
        <li>Usar <code>&lt;button class="tab-btn"&gt;</code> para tabs secundarios (más sutiles)</li>
      </ul>
    </div>
  </section>

  <!-- Layout 2 Columnas -->
  <section class="section">
    <h2><i class="pi pi-objects-column"></i> Layout de 2 Columnas</h2>
    <p class="section-description">
      El contenido se divide en columna principal (información detallada) y sidebar (métricas y visualizaciones).
    </p>

    <div class="info-card">
      <h4><i class="pi pi-exclamation-triangle text-orange-500"></i> Dimensiones Importantes</h4>
      <ul>
        <li><code>main-content</code>: Ocupa el espacio restante (<code>1fr</code>)</li>
        <li><code>sidebar</code>: Ancho fijo de <code>380px</code> a <code>440px</code></li>
        <li>En responsive (< 1200px): Se apila en una sola columna</li>
        <li>El sidebar incluye: stats-section y graph-section</li>
      </ul>
    </div>
  </section>

  <!-- Entity Header Row -->
  <section class="section">
    <h2><i class="pi pi-id-card"></i> Entity Header Row</h2>
    <p class="section-description">
      Primera sección del contenido que muestra el nombre de la entidad junto con su estado de salud.
    </p>

    <div class="entity-demo-row">
      <div class="entity-demo-left">
        <h4>Nombre de la Entidad <span class="code-badge">ACT-001</span></h4>
        <p>Descripción breve de la entidad que proporciona contexto adicional sobre su propósito.</p>
      </div>
      <div class="entity-demo-right">
        <div class="status-demo-card">
          <span class="status-title"><i class="pi pi-heart-fill"></i> Estado</span>
          <p-tag value="Saludable" severity="success" />
        </div>
      </div>
    </div>
  </section>

  <!-- Paginas que lo usan -->
  <section class="section">
    <h2><i class="pi pi-link"></i> Páginas que Usan este Template</h2>
    <app-ds-usage-list
      [items]="usageItems"
      type="pages"
    />
  </section>

  <!-- Props Tables -->
  <section class="section">
    <h2><i class="pi pi-list"></i> Clases CSS</h2>
    <p class="section-description">Clases CSS utilizadas en este template.</p>

    <h3>Layout Principal</h3>
    <app-ds-props-table [props]="layoutProps" />

    <h3>Header</h3>
    <app-ds-props-table [props]="headerProps" />

    <h3>Contenido</h3>
    <app-ds-props-table [props]="contentProps" />

    <h3>Sidebar</h3>
    <app-ds-props-table [props]="sidebarProps" />
  </section>

  <!-- Design Tokens -->
  <section class="section">
    <h2><i class="pi pi-sliders-h"></i> Design Tokens</h2>
    <p class="section-description">Tokens CSS utilizados por este template.</p>

    <div class="tokens-grid">
      @for (token of tokens; track token.name) {
        <div class="token-item">
          <div class="token-preview" [style.background]="token.value"></div>
          <div class="token-info">
            <code>{{ token.name }}</code>
            <span>{{ token.description }}</span>
          </div>
        </div>
      }
    </div>
  </section>

  <!-- Codigo -->
  <section class="section">
    <h2><i class="pi pi-code"></i> Código</h2>
    <p class="section-description">Código base para implementar este template.</p>
    <app-ds-code-tabs [tabs]="codeTabs" />
  </section>

  <!-- Dark Mode -->
  <section class="section">
    <h2><i class="pi pi-moon"></i> Dark Mode</h2>
    <p class="section-description">
      El template usa tokens semánticos que se adaptan automáticamente a dark mode.
    </p>

    <div class="info-card">
      <h4>Tokens que cambian en Dark Mode</h4>
      <ul>
        <li><code>--surface-ground</code> - Fondo de página</li>
        <li><code>--surface-card</code> - Fondo de cards y contenido</li>
        <li><code>--surface-border</code> - Bordes</li>
        <li><code>--text-color</code> y <code>--text-color-secondary</code> - Texto</li>
        <li><code>--primary-color</code> se mantiene pero sobre fondos oscuros</li>
      </ul>
    </div>
  </section>
</div>
