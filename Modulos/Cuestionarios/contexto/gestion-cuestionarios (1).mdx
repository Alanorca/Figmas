---
title: "Gesti√≥n de Cuestionarios de Cumplimiento"
sidebar_label: "Cuestionarios"
sidebar_position: 4
---

import ZoomableDiagram from '@site/src/components/ZoomableDiagram';

# Historia de Usuario: Gesti√≥n de Cuestionarios de Cumplimiento

## üìã Informaci√≥n General

- **ID**: US-QUESTIONNAIRES-001
- **M√≥dulo**: Gesti√≥n de Cumplimiento / Cuestionarios
- **Prioridad**: Alta
- **Sprint**: Sprint 3

## üë§ Historia de Usuario

**Como** Gestor de Cumplimiento, Auditor o Coordinador de Calidad
**Quiero** crear, gestionar y aplicar cuestionarios de evaluaci√≥n de manera manual o asistida por IA, configurando diferentes tipos de preguntas, umbrales de cumplimiento y l√≥gica condicional
**Para** poder estandarizar procesos de evaluaci√≥n, asegurar consistencia en auditor√≠as, y generar cuestionarios especializados a partir de documentos normativos, pol√≠ticas internas o est√°ndares de la industria sin esfuerzo manual.

## ‚úÖ Criterios de Aceptaci√≥n

### Feature: Creaci√≥n Manual de Cuestionarios

```gherkin
Scenario: Crear cuestionario manualmente con m√∫ltiples tipos de preguntas
  Given un "Gestor de Cumplimiento" est√° en el m√≥dulo de "Cuestionarios"
  When selecciona "Crear Nuevo Cuestionario"
  And ingresa el t√≠tulo "Evaluaci√≥n de Seguridad de la Informaci√≥n ISO 27001"
  And ingresa la descripci√≥n del cuestionario
  And define los umbrales de cumplimiento:
    | Nivel           | Rango       |
    | Deficiente      | 0-30%       |
    | Aceptable       | 31-70%      |
    | Sobresaliente   | 71-100%     |
  And crea una secci√≥n "Gesti√≥n de Activos" con descripci√≥n
  And agrega las siguientes preguntas a la secci√≥n:
    | Tipo             | Texto de Pregunta                                  | Configuraci√≥n                |
    | YES_NO           | ¬øExiste un inventario de activos de informaci√≥n?   | Obligatoria                 |
    | SINGLE_SELECT    | Nivel de clasificaci√≥n de la informaci√≥n           | Opciones: P√∫blica/Interna/Confidencial/Secreta |
    | STAR_RATING      | Calidad del proceso de gesti√≥n de activos          | 1-10 estrellas              |
    | FREE_TEXT        | Describa el proceso de clasificaci√≥n               | Permite evidencia y comentarios |
  And hace clic en "Guardar Cuestionario"
  Then el sistema crea el cuestionario con ID √∫nico
  And el cuestionario aparece en la lista de plantillas disponibles
  And muestra un resumen: "4 preguntas en 1 secci√≥n"
```

```gherkin
Scenario: Configurar l√≥gica condicional en preguntas
  Given existe un cuestionario "Evaluaci√≥n de Controles de Acceso"
  When el "Auditor" edita el cuestionario
  And agrega una pregunta P1: "¬øUtiliza autenticaci√≥n multifactor?" (YES_NO)
  And agrega una pregunta P2: "¬øQu√© m√©todo de MFA utiliza?" (DROPDOWN)
  And configura P2 con condici√≥n de visualizaci√≥n:
    | Campo                      | Valor               |
    | displayConditionQuestionId | ID de P1            |
    | displayConditionAnswer     | "S√≠"                |
  And guarda el cuestionario
  Then el sistema valida la l√≥gica condicional
  And P2 solo se mostrar√° cuando P1 sea respondida con "S√≠"
  And al previsualizar, P2 aparece/desaparece din√°micamente seg√∫n P1
```

### Feature: Generaci√≥n de Cuestionarios Asistida por IA

```gherkin
Scenario: Generar cuestionario a partir de documento PDF de normativa
  Given un "Gestor de Cumplimiento" est√° en "Crear Cuestionario"
  When selecciona "Generar con IA"
  And sube un documento PDF "ISO-27001-2022-Controles.pdf" (150 p√°ginas)
  And selecciona las siguientes opciones:
    | Par√°metro          | Valor                                      |
    | Tipo de Cuestionario | Auditor√≠a de Seguridad                   |
    | Complejidad        | Avanzado (6-8 secciones, 8-12 preguntas) |
    | √Åreas de Enfoque   | Gesti√≥n de Activos, Control de Acceso, Cifrado |
    | Idioma             | Espa√±ol                                   |
  And hace clic en "Generar Cuestionario"
  Then el sistema procesa el PDF extrayendo el texto completo
  And la IA analiza el contenido del documento
  And genera un cuestionario con la siguiente estructura:
    | Elemento                | Validaci√≥n                                    |
    | T√≠tulo                  | M√°ximo 80 caracteres, descriptivo            |
    | Descripci√≥n             | 30-400 caracteres, basada en el documento    |
    | Secciones               | 6-8 secciones tem√°ticas                      |
    | Preguntas por secci√≥n   | 8-12 preguntas relevantes                    |
    | Tipos de pregunta       | Mix de YES_NO, SINGLE_SELECT, LIKERT_SCALE, FREE_TEXT |
    | Umbrales                | Deficiente: 30, Aceptable: 70, Sobresaliente: 100 |
  And el cuestionario generado aparece en modo "Previsualizaci√≥n"
  And el usuario puede editar, ajustar o aprobar el cuestionario generado
  And muestra metadata: tiempo de procesamiento, n√∫mero total de preguntas, advertencias
```

```gherkin
Scenario: IA sugiere mejoras a cuestionario existente
  Given existe un cuestionario manual "Evaluaci√≥n GDPR B√°sica" con 10 preguntas
  When el "Auditor" selecciona "Mejorar con IA"
  And sube un documento actualizado "GDPR-2024-Guidelines.pdf"
  Then la IA analiza el cuestionario existente y el nuevo documento
  And sugiere:
    | Tipo de Sugerencia          | Detalle                                           |
    | Nuevas preguntas            | 5 preguntas adicionales sobre nuevas cl√°usulas    |
    | Preguntas a modificar       | 2 preguntas desactualizadas                       |
    | Nuevas secciones            | 1 secci√≥n sobre "Transferencias Internacionales" |
  And el usuario puede aceptar o rechazar cada sugerencia individualmente
  And al aceptar, el cuestionario se actualiza autom√°ticamente
```

### Feature: Validaci√≥n y Gesti√≥n de Cuestionarios

```gherkin
Scenario: Validaci√≥n estricta de estructura de cuestionario
  Given un "Coordinador" intenta crear un cuestionario
  When ingresa un t√≠tulo de 100 caracteres (excede l√≠mite de 80)
  And crea una secci√≥n sin preguntas
  And agrega una pregunta SINGLE_SELECT sin opciones
  And define umbrales: Deficiente: 50, Aceptable: 40, Sobresaliente: 100
  And hace clic en "Guardar"
  Then el sistema muestra errores de validaci√≥n:
    | Error                                              |
    | "El t√≠tulo debe tener m√°ximo 80 caracteres"       |
    | "Cada secci√≥n debe tener m√≠nimo 1 pregunta"       |
    | "SINGLE_SELECT debe tener al menos 2 opciones"    |
    | "Los umbrales deben cumplir: deficient < acceptable < outstanding" |
  And no permite guardar hasta que se corrijan los errores
```

```gherkin
Scenario: Duplicar cuestionario existente para crear variante
  Given existe un cuestionario "Auditor√≠a Anual de TI 2024"
  When el "Gestor" selecciona "Duplicar Cuestionario"
  And modifica el t√≠tulo a "Auditor√≠a Anual de TI 2025"
  And ajusta 3 preguntas para reflejar nuevas normativas
  And guarda el cuestionario duplicado
  Then el sistema crea un nuevo cuestionario con ID diferente
  And el cuestionario original permanece sin cambios
  And el nuevo cuestionario hereda toda la estructura del original
```

## üîÑ Flujo de Usuario

<ZoomableDiagram
  title="Flujo Completo de Gesti√≥n de Cuestionarios"
  height="900px"
  chart={`graph TD
    subgraph "Creaci√≥n Manual"
        StartManual[Gestor selecciona<br/>Crear Cuestionario] --> ConfigBasic[Ingresar T√≠tulo,<br/>Descripci√≥n y Umbrales]
        ConfigBasic --> AddSection[Crear Secci√≥n]
        AddSection --> AddQuestion[Agregar Pregunta]
        AddQuestion --> ConfigQuestion[Configurar Tipo,<br/>Opciones, Validaciones]
        ConfigQuestion --> ConditionalLogic{¬øL√≥gica<br/>Condicional?}
        ConditionalLogic -->|S√≠| SetCondition[Definir Condici√≥n<br/>de Visualizaci√≥n]
        ConditionalLogic -->|No| MoreQuestions{¬øM√°s<br/>Preguntas?}
        SetCondition --> MoreQuestions
        MoreQuestions -->|S√≠| AddQuestion
        MoreQuestions -->|No| MoreSections{¬øM√°s<br/>Secciones?}
        MoreSections -->|S√≠| AddSection
        MoreSections -->|No| ValidateManual[Validar Estructura]
        ValidateManual --> SaveQuestionnaire[Guardar Cuestionario]
    end

    subgraph "Generaci√≥n Asistida por IA"
        StartAI[Gestor selecciona<br/>Generar con IA] --> UploadDoc[Subir Documento<br/>PDF/Word/Excel]
        UploadDoc --> ConfigAI[Configurar Par√°metros IA]
        ConfigAI --> ConfigAIParams[Tipo, Complejidad,<br/>√Åreas de Enfoque, Idioma]
        ConfigAIParams --> ProcessDoc[Procesar Documento]
        ProcessDoc --> ExtractText[Extraer Texto Completo<br/>OCR si es necesario]
        ExtractText --> AIAnalysis[IA Analiza Contenido]
        AIAnalysis --> GenerateStructure[IA Genera Estructura<br/>de Cuestionario]
        GenerateStructure --> GenerateSections[IA Crea Secciones<br/>Tem√°ticas]
        GenerateSections --> GenerateQuestions[IA Genera Preguntas<br/>por Secci√≥n]
        GenerateQuestions --> AssignTypes[IA Asigna Tipos<br/>de Pregunta Apropiados]
        AssignTypes --> SetThresholds[IA Define Umbrales<br/>de Cumplimiento]
        SetThresholds --> ValidateAI[Validaci√≥n Autom√°tica<br/>de Estructura]
        ValidateAI --> PreviewAI[Mostrar Preview<br/>con Metadata]
        PreviewAI --> ReviewAI{Usuario<br/>Revisa}
        ReviewAI -->|Editar| EditGenerated[Editar Cuestionario<br/>Generado]
        ReviewAI -->|Regenerar| ConfigAI
        ReviewAI -->|Aprobar| SaveQuestionnaire
        EditGenerated --> SaveQuestionnaire
    end

    subgraph "Gesti√≥n de Cuestionarios"
        SaveQuestionnaire --> QuestionnaireList[Lista de Cuestionarios<br/>Disponibles]
        QuestionnaireList --> ManageActions{Acci√≥n}
        ManageActions -->|Editar| EditExisting[Editar Cuestionario]
        ManageActions -->|Duplicar| DuplicateQ[Duplicar y Modificar]
        ManageActions -->|Mejorar con IA| ImproveWithAI[IA Sugiere Mejoras]
        ManageActions -->|Eliminar| DeleteQ[Eliminar Cuestionario]
        ManageActions -->|Aplicar| UseInReview[Usar en Revisi√≥n<br/>de Cumplimiento]
        EditExisting --> ValidateManual
        DuplicateQ --> EditExisting
        ImproveWithAI --> ReviewSuggestions[Revisar y Aceptar<br/>Sugerencias]
        ReviewSuggestions --> EditExisting
    end

    style StartManual stroke:#4caf50,stroke-width:2px
    style StartAI stroke:#2196f3,stroke-width:2px
    style ProcessDoc stroke:#ff9800,stroke-width:3px,stroke-dasharray: 5 5
    style AIAnalysis stroke:#9c27b0,stroke-width:3px,stroke-dasharray: 5 5
    style ValidateAI stroke:#e91e63,stroke-width:2px
    style SaveQuestionnaire stroke:#4caf50,stroke-width:3px
  `}
/>

## üé® Mockups / Dise√±os

Dise√±os disponibles en Figma (Pendientes de revisi√≥n por UX/UI Designer: Alan Franco)

## üì° Documentaci√≥n T√©cnica Relacionada

### API Endpoints

```typescript
// Cuestionarios - CRUD B√°sico
POST   /api/questionnaire-templates              // Crear cuestionario manual
GET    /api/questionnaire-templates              // Listar todos los cuestionarios
GET    /api/questionnaire-templates/:id          // Obtener cuestionario por ID
PUT    /api/questionnaire-templates/:id          // Actualizar cuestionario
DELETE /api/questionnaire-templates/:id          // Eliminar cuestionario

// Generaci√≥n Asistida por IA
POST   /api/ai/generate-questionnaire             // Generar cuestionario con IA
  Body: {
    file: File,                                    // Documento fuente (PDF, Word, Excel, Imagen)
    questionnaireType: string,                     // Tipo de cuestionario
    complexity: 'basic' | 'intermediate' | 'advanced',
    focusAreas: string[],                          // √Åreas de enfoque (opcional)
    language: 'es' | 'en'                          // Idioma
  }
  Response: {
    title: string,
    description: string,
    sections: Section[],
    complianceThresholds: { deficientUpperBoundary, acceptableUpperBoundary, outstandingUpperBoundary },
    _metadata: { processingTimeMs, documentLength, totalQuestions, warnings }
  }

// Mejora de Cuestionario Existente con IA
POST   /api/ai/improve-questionnaire              // Sugerir mejoras con IA
  Body: {
    questionnaireId: string,
    newDocument: File                              // Documento actualizado
  }
  Response: {
    suggestions: {
      newQuestions: Question[],
      questionsToModify: { questionId, suggestion }[],
      newSections: Section[]
    }
  }

// Validaci√≥n y Preview
POST   /api/questionnaire-templates/validate      // Validar estructura de cuestionario
POST   /api/questionnaire-templates/:id/duplicate // Duplicar cuestionario
```

### Reglas de Negocio

1. **Estructura de Cuestionario**:
   - T√≠tulo: 5-80 caracteres, obligatorio
   - Descripci√≥n: 30-400 caracteres, obligatoria
   - M√≠nimo 2 secciones por cuestionario
   - M√≠nimo 1 pregunta por secci√≥n (recomendado: 2+)
   - M√°ximo 120 preguntas por cuestionario (para UX √≥ptimo)

2. **Umbrales de Cumplimiento**:
   - Tres niveles: Deficiente, Aceptable, Sobresaliente
   - Rango: 0-100
   - Debe cumplir: `deficientUpperBoundary < acceptableUpperBoundary < outstandingUpperBoundary`
   - Diferencia m√≠nima recomendada: 30 puntos entre umbrales

3. **Tipos de Preguntas Soportados**:
   - **FREE_TEXT**: Respuesta abierta, permite evidencia y comentarios
   - **BOOLEAN**: Verdadero/Falso
   - **NUMBER**: Campo num√©rico (requiere minValue, maxValue)
   - **YES_NO**: S√≠/No con radio buttons
   - **SINGLE_SELECT**: Opci√≥n √∫nica (requiere 2+ opciones con text y score)
   - **MULTI_SELECT**: M√∫ltiple selecci√≥n (requiere 2+ opciones)
   - **DROPDOWN**: Lista desplegable para listas largas
   - **STAR_RATING**: Calificaci√≥n con estrellas (maxValue: 5 o 10)
   - **LIKERT_SCALE**: Escala de acuerdo (exactamente 5 opciones)
   - **NUMERIC_SCALE**: Slider num√©rico (requiere minValue, maxValue)
   - **SEMANTIC_DIFFERENTIAL**: Escala entre opuestos (requiere leftAnchor, rightAnchor)
   - **RANKING**: Ordenamiento por preferencia (3-6 opciones)

4. **L√≥gica Condicional**:
   - Preguntas pueden tener condiciones de visualizaci√≥n
   - `displayConditionQuestionId`: ID de la pregunta condicionante
   - `displayConditionAnswer`: Respuesta esperada para mostrar la pregunta
   - Valida que la pregunta condicionante exista en el mismo cuestionario

5. **Generaci√≥n con IA**:
   - Documentos soportados: PDF, Word (.doc, .docx), Excel (.xls, .xlsx), Texto plano, Im√°genes (con OCR)
   - Tama√±o m√°ximo: 200MB
   - Timeout de procesamiento: 300 segundos (5 minutos)
   - Timeout de generaci√≥n IA: 240 segundos (4 minutos)
   - Tokens m√°ximos de respuesta: 12,000
   - Contenido m√≠nimo: 100 caracteres
   - Temperatura IA: 0.1 (primera generaci√≥n), 0.2 (reintentos)

6. **Validaci√≥n Autom√°tica**:
   - El sistema valida estructura completa antes de guardar
   - Reporta errores (bloquean guardado) y advertencias (no bloquean)
   - Valida tipos de pregunta y sus configuraciones espec√≠ficas
   - Verifica que opciones de selecci√≥n tengan text y score

### Modelo de Datos

```typescript
// Firestore Collection: questionnaireTemplates
interface QuestionnaireTemplate {
  id: string;
  title: string;                                   // 5-80 chars
  description: string;                             // 30-400 chars
  sections: QuestionnaireSection[];
  complianceThresholds: ComplianceThresholds;
  createdAt: string;                               // ISO date
  updatedAt: string;                               // ISO date
  createdBy?: string;                              // User UUID

  // Opcional: Configuraci√≥n para auto-creaci√≥n de activos
  autoAssetCreation?: {
    enabled: boolean;
    assetTypeId: string;                           // ID del AssetTemplate (Riesgos, Incidentes, Hallazgos)
  };
}

interface QuestionnaireSection {
  id: string;                                      // UUID
  title: string;                                   // 5-80 chars
  description?: string;                            // 30-250 chars
  questions: Question[];
}

interface Question {
  id: string;                                      // UUID
  text: string;                                    // 10-200 chars
  type: QuestionType;                              // Enum de tipos soportados
  isRequired?: boolean;
  allowsEvidence?: boolean;
  allowsComments?: boolean;

  // Campos para tipos num√©ricos
  minValue?: number;
  maxValue?: number;
  stepValue?: number;

  // Campos para SEMANTIC_DIFFERENTIAL
  leftAnchor?: string;
  rightAnchor?: string;

  // Campos para tipos con opciones
  options?: QuestionOption[];

  // L√≥gica condicional
  displayConditionQuestionId?: string;
  displayConditionAnswer?: string;
}

interface QuestionOption {
  text: string;
  score: number;                                   // Puntaje para c√°lculo de compliance
}

interface ComplianceThresholds {
  deficientUpperBoundary: number;                  // Ej: 30 (0-30 = Deficiente)
  acceptableUpperBoundary: number;                 // Ej: 70 (31-70 = Aceptable)
  outstandingUpperBoundary?: number;               // Ej: 100 (71-100 = Sobresaliente)
}

enum QuestionType {
  FREE_TEXT = 'FREE_TEXT',
  BOOLEAN = 'BOOLEAN',
  NUMBER = 'NUMBER',
  YES_NO = 'YES_NO',
  SINGLE_SELECT = 'SINGLE_SELECT',
  MULTI_SELECT = 'MULTI_SELECT',
  DROPDOWN = 'DROPDOWN',
  STAR_RATING = 'STAR_RATING',
  LIKERT_SCALE = 'LIKERT_SCALE',
  NUMERIC_SCALE = 'NUMERIC_SCALE',
  SEMANTIC_DIFFERENTIAL = 'SEMANTIC_DIFFERENTIAL',
  RANKING = 'RANKING'
}
```

## üìù Notas Adicionales

### Equipo

- **Product Owner**: Francisco Puente
- **UX/UI Designer**: Alan Franco
- **Frontend Developers**: Cesar Gonzalez, Juan Martinez
- **Backend Developer**: Josue Cardenas
- **AI/ML Engineer**: (Nuevo rol requerido para optimizaci√≥n de prompts)
- **QA Engineer**: Emmanuel Vazquez

### Alcance

#### ‚úÖ Fase 1 incluye:

- Funcionalidad CRUD completa de Cuestionarios
- Interfaz de creaci√≥n manual con editor visual
- Soporte completo para 12 tipos de preguntas
- L√≥gica condicional de visualizaci√≥n de preguntas
- Configuraci√≥n de umbrales de cumplimiento personalizables
- Generaci√≥n asistida por IA desde documentos (PDF, Word, Excel, Im√°genes)
- Procesamiento OCR para im√°genes
- Validaci√≥n estricta de estructura
- Duplicaci√≥n de cuestionarios
- Sistema de sugerencias de mejora con IA
- Previsualizaci√≥n de cuestionarios
- Metadata y telemetr√≠a de generaci√≥n IA

#### ‚è≥ No incluye (Fase 2):

- Biblioteca de cuestionarios pre-construidos (templates de industria)
- Versionamiento de cuestionarios
- Colaboraci√≥n multi-usuario en tiempo real
- Importaci√≥n masiva de cuestionarios desde archivos estructurados
- An√°lisis de efectividad de preguntas (tasas de respuesta, discriminaci√≥n)
- Traducci√≥n autom√°tica de cuestionarios a m√∫ltiples idiomas
- Integraci√≥n con frameworks de cumplimiento (SOC 2, ISO 27001, NIST)
- Sistema de etiquetado y categorizaci√≥n avanzado
- B√∫squeda sem√°ntica de cuestionarios por contenido

### Roadmap

| Fase     | Fecha Estimada   | Estado        |
|----------|------------------|---------------|
| Fase 1   | 15/diciembre/2025| En Desarrollo |
| Fase 2   | Q1 2026          | Planificado   |

## üè∑Ô∏è Etiquetas

`compliance` `questionnaires` `ai-generation` `ocr` `document-processing` `auditing` `quality-assurance` `conditional-logic` `validation` `genkit` `sprint-3` `grc`

---

**√öltima actualizaci√≥n**: 19/11/2025
